<!Doctype html>

<head>
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <link href="external/icon.css" rel="stylesheet">
    <link rel="stylesheet" href="external/materialize.min.css">
    <script src="external/materialize.min.js"></script>
    <link rel="stylesheet" href="css/main.css">
    <script src="js/coms.js"></script>
    <style>
        h4 {
            text-align: center;
        }
        
        .item {
            width: 60vw;
        }
    </style>
</head>

<body>
    <nav>
        <div class="nav-wrapper green"> <a href="index.html" class="brand-logo">&nbsp;Frolf&nbsp;</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a href="scores.html">Scores</a></li>
                <li><a href="courses.html">Courses</a></li>
                <li><a href="games.html">Games</a></li>
                <li><a href="peoples.html">People</a></li>
            </ul>
        </div>
    </nav>
    <ul id="slide-out" class="sidenav">
        <li><a href="scores.html">Scores</a></li>
        <li><a href="courses.html">Courses</a></li>
        <li><a href="games.html">Games</a></li>
        <li><a href="peoples.html">People</a></li>
        <li>
            <button class="signout btn-flat" onclick="logout()">Sign Out</button>
        </li>
    </ul>
    <div class="ver cent">
        <ul id="list" class="collection with-header">
            <li class="collection-header">
                <h4>Handicap</h4></li>
        </ul>
    </div>
    <script>
        var handilist;
        window.onload = function () {
            M.AutoInit();
            handilist = [];
            getHandicaps(getPids());
            sync();
        }

        function addItem(name, handicap, pid) {
            let li = document.createElement("li");
            li.setAttribute("class", "item hor spread collection-item clickable");
            li.onclick = function () {
                window.location.href = "person.html?" + pid
            };
            li.innerHTML = "<p>" + name + ": </p><p>" + handicap + "</p>";
            document.getElementById("list").appendChild(li);
        }

        function getHandicaps() {
            let names = JSON.parse(localStorage.getItem("names"));
            for (let n of names) {
                loadHandicap(n[0]);
            }
        }

        function loadHandicap(pid) {
            get("/player/" + pid, (data) => {
                let d = JSON.parse(data);
                handilist.push({
                    "name": d.name
                    , "handi": d.handicap
                    , "pid": pid
                });
                refresh();
            });
        }

        function refresh() {
            document.getElementById("list").innerHTML = '<li class="collection-header"><h4>Handicap</h4></li>';
            handilist.sort((a, b) => a.handi - b.handi);
            for (let d of handilist) {
                addItem(d.name, d.handi, d.pid);
            }
        }

        function getPids() {
            let names = JSON.parse(localStorage.getItem("names"));
            return names.map((v, i, a) => {
                return v[0]
            });
        }
    </script>
</body>